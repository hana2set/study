## 데이터베이스 구축 우선순위

1. 데이터 무결성
2. 데이터베이스 성능
3. 데이터베이스 관리의 용이성
4. 개발자 편의성

##### 3, 4순위을 우선적으로 고려하지 않도록 주의할 것

<br>
<br>

## PK 
PK 인덱스를 최대한 이용하게끔 설계해야함.
* 복합키 사용할 경우 사용빈도, 중복성 등을 염두하여 앞에 배치되도록 설계

<br>
<br>


## PK vs UI
UI(Unique Index) 의 장점은 개발과 유지보수에 있어서 약간의 편의성 제공
<br>
PK가 더 많은 이점을 제공함으로 UI는 고려대상이 아님.

* 이점: 무결성/유일성 보장, not null, 역공학 시 이점 ...

<br>

_어플리케이션 유연성을 위해 UI를 사용하는 경우가 있는데,(SAP ERP, 오라클 ERP 등) <br>이 경우 소스코드를 통해 무결성을 구현하고 있음. (사실상 PK사용과 다를 바가 없음)_

<br>
<br>


## 식별자관계. 비식별지관계
서로 장단점이 있음으로 적절하게 분할해야함.


```
요인 

식별자관계 - 복잡도가 증가할 수 있음. (주식별자 속성 수의 증가)
비식별자관계 - 불필요한 테이블 조인 강제될 수 있음. 
```


##### 다음 관계의 경우 비식별자관계 고려
* 약한 관계
* 자식테이블 독립 PK 구성
* PK 속성의 단순화 필요 (SQL 복잡도 증가, 개발 생산성 저하로 인한)

<br>
<br>


## 이력테이블
이력 데이터 양이 적다면 굳이 분리하지 않는 것도 좋은 방법.

주로 "1:M 스냅샷 군집 전체 이력 방식" 사용, 행 단위로 관리 

<details>
	<summary>1:M 스냅샷 군집 전체 이력 방식</summary>
    
    마스터 테이블의 일부 컬럼들을 묶어 별도의 테이블에 마스터에 테이블의 현재정보를 포함한 모든 변경된 정보를 보관

</details>

<br>
<br>

## 엔티티 통합
트랜잭션에 따라 성능이 달라짐.
> 多: DB Lock 문제로 성능 하락
<br> 少: 조인이 없어짐으로 성능 상승(별차이 없음)

* 장점: 복잡도 낮아짐, 유지보수성 좋아짐
* 단점: 속성 제약 걸기 어려워짐, 유연성 하락, 업무 이해도 낮아짐(개발자가 분석해야 함)

##### 다음 단계 고려
1. 논리적 데이터 모델링에서는 상세하게 분리
2. 물리적 데이터 모델링에서는 성능을 고려하여 통합 유도 (조인 성능 개선 vs 데이터 집약 성능 저하)
3. 업무적 중요성을 갖는 트랜잭션의 발생 패턴을 분석하여 통합/분리 결정
4. 데이터량/트랜잭션 빈도가 적을 경우 가급적 통합된 데이터 모델 구성 (단순성 확보)

<br>
<br>


## 자기참조관계

* 관계 속성에 인덱스 필수

* 적합한 SQL 문장 탐구
    * CONNECT BY PRIOR
* M:N 자기참조관계는 피할 것
    * 가급적 엔티티 분할 후 1:M 관계로 데이터 조정 후 인덱싱


<br>
<br>


## 엔티티 타입 도출

* 명사형 도출
* 정규화 이용
* 엔티티타입 구분에 의한 4-STEP 데이터 모델링
    * 구조 -> 업무 흐름 -> 기술적 모델링 -> 모델 검토

검증으로 CRUD Matrix(상관 매트릭스) 이용

![CRUD Matrix](https://www.visual-expert.com/images/blog-CRUD-Matrix.png)


<br>
<br>

## 용어사전과 도메인
큰 규모 데이터베이스에서 정의하지 않으면 성능저하 가능성 높음

<br>
<br>

## 데이터 모델 검증
검증 시 관점
* 업무적 관점
    * 사용자 요구사항과 대비하여 미도출된 엔티티타입 및 속성은 없는가?
    * 엔티티 타입간의 관계는 업무절차와 잘 부합하는가?
* 규약적 측면
    * 다른 타입/크기, contraint를 가지는 중복된 속성은 존재하지 않는가?
    * 엔티티간의 관계가 M:N으로 정의된 것은 없는가
    * 엔티티타입명, 속성명, 관계명에 대한 정의는 모델의 일반 규약을 준수하고 있는가?

<br>
 
체크리스트 (상세내용 생략)
* 엔티티타입, 속성, 관계, PK, 용어/도메인
    

<br>
<br>

## 논리/물리 데이터 모델
논리적인 데이터 모델은 비즈니스 중심의 __정규화__ 모델 <br>
물리적인 데이터 모델은 데이터베이스 중심의 __반정규화__ 모델 (성능중심)


논리적 데이터 모델 누락시
* 데이터 모델의 확장성 확보 불가
* 모델을 통해 업무흐름 파악이 안됨으로 커뮤니케이션 제약 발생

물리적 데이터 모델 누락시
* 데이터베이스 성능 저하
* 데이터베이스 오브젝트에 대해 관리가 수행되지 않음


<br>
<br>
<br>
<br>
<br>
<br>


<br>
<br>
<br>

참조:
> 아는 만큼 보이는 데이터베이스 설계와 구축, 이춘식 지음

출처 
> CRUD Matrix : https://www.visual-expert.com/EN/visual-expert-documentation/code-cross-references/crud-matrix-generator.html
